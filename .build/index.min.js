const root=document.body,config={...window.__CONFIG__,sitemap:void 0},sitemap=window.__CONFIG__.sitemap,removeChildren=e=>({...e,children:void 0}),fetchJSON=(e,t)=>new Promise(n=>{fetch(e,t).then(a=>{if(a.ok)return n(a.json());setTimeout(()=>fetchJSON(e,t).then(n),2e3)}).catch(a=>{setTimeout(()=>fetchJSON(e,t).then(n),2e3)})}),isOutViewport=(e,t)=>{var n=e.getBoundingClientRect(),a=t.getBoundingClientRect();return a.top<n.top||a.right>n.right||a.bottom>n.bottom||a.left<n.left};let path=window.location.pathname,exists=!0,loading=!0;const cache=new Map,directories=new Map,files=new Map;let headings=[];const cursus=[];let current,readingHeadingsCount=0,isObserverFirstRound=!0,contentElement,menuOpened=!1,isFirstPage=!0;const setHeadingReadingStatus=(e,t)=>{let n=headings.findIndex(t=>t.hash===e);-1!==n&&(headings[n].reading=t)},observerCallback=e=>{if(0===readingHeadingsCount)for(let t of headings)t.reading=!1;for(let n of e)!0===n.isIntersecting?(setHeadingReadingStatus(n.target.id,!0),readingHeadingsCount++):(setHeadingReadingStatus(n.target.id,!1),!isObserverFirstRound&&readingHeadingsCount--);if(0===(readingHeadingsCount=Math.max(0,readingHeadingsCount))&&contentElement)for(let a=headings.length-1;a>=0;a--){let r=contentElement.querySelector("#"+headings[a].hash)?.getBoundingClientRect();if(r&&r.top-r.height<=80){headings[a].reading=!0;break}}isObserverFirstRound=!1,m.redraw()},observerOptions={root:document.getElementById("content"),rootMargin:"0px 0px -20% 0px",threshold:1};let observer=new IntersectionObserver(observerCallback,observerOptions);const updateTableOfContent=()=>{for(let e of(readingHeadingsCount=0,isObserverFirstRound=!0,headings=[],contentElement?.querySelectorAll("h1[id], h2[id]")??[]))headings.push({label:e.textContent,level:"H1"===e.nodeName?1:2,hash:e.id,reading:!1}),observer.observe(e);m.redraw()},saveSitemapChild=(e,t)=>{0===e.type?(cursus.push(e.link),files.set(e.link,{...e,parent:removeChildren(t)})):directories.set(e.link,{...e,parent:removeChildren(t),children:e.children.map(removeChildren)})},browseSitemapChilds=e=>{for(let t of e.children)saveSitemapChild(t,e),1===t.type&&browseSitemapChilds(t)},generateMaps=()=>{for(let e of sitemap)saveSitemapChild(e,void 0),1===e.type&&browseSitemapChilds(e)},loadPath=e=>{loading=!0,fetchJSON(`/api/doc${e}.json`).then(t=>{cache.set(e,t),loading=!1,update()}).catch(()=>{cache.set(e,void 0),loading=!1,current=void 0,update()})},openNav=()=>{let e=path,t=n=>{for(let a of n)if(1===a.type&&e.startsWith(a.link)&&"/"===e.substring(a.link)[0]){a.open=!0,t(a.children);break}};t(sitemap)},showPath=e=>{openNav();let t=cursus.indexOf(e),n=t>0&&-1!==t?cursus[t-1]:null,a=t<cursus.length-1&&-1!==t?cursus[t+1]:null;current={...cache.get(e),...files.get(e),...directories.get(e),next:a,previous:n},document.title=`${current.label} \xb7 ${config.title}`},update=()=>{if((path=window.location.pathname).endsWith("/")&&path.length>1&&(path=path.slice(0,-1),history.replaceState({},"",path)),files.has(path)){if(exists=!0,!cache.has(path))return loadPath(path);showPath(path)}else directories.has(path)?(exists=!0,current=directories.get(path),openNav()):(exists=!1,current=void 0);m.redraw.sync(),updateTableOfContent(),showCurrentHash(),isFirstPage=!1},navigate=e=>{window.history.pushState({},e,e),e=window.location.pathname,menuOpened=!1,update()},showCurrentHash=()=>{window.location.hash?document.querySelector(`.body ${window.location.hash}`)?.scrollIntoView():document.querySelector(".body").scrollTop=0},navigationArrow={view:e=>m("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",class:"arrow",onclick:e.attrs.onclick},m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":2,d:"M9 5l7 7-7 7"}))},navFragment={view:e=>m("div",{class:"category","max-height":""},e.attrs.children.map(t=>{if(0===t.type){if(e.attrs.level>1&&t.link===e.attrs.parent)return;return m("a",{href:t.link,class:t.link===path?"current-link":"",onclick(e){navigate(t.link),e.preventDefault()}},m("span",t.label))}if(1===t.type){let n=m(navFragment,{children:t.children,level:e.attrs.level+1,parent:t.link});return 0===e.attrs.level?[m("h1",t.label),n]:[m("a",{class:t.link===path?"current-link":"",open:t.open,href:t.link,onclick(e){e.preventDefault(),e.currentTarget===e.target&&(t.open=!0,navigate(t.link))}},[m("span",t.label),m(navigationArrow,{onclick:()=>t.open=!t.open})]),n]}}))},notFound={view:()=>m("div",{class:"notfound"},loading?void 0:[m("h1","O.o"),m("span","Page not found")])},redirect={view:e=>m("div",{class:"redirect",onclick:()=>navigate(e.attrs.child.link)},[m("span",e.attrs.child.label),m(navigationArrow)])},bottomNavLink={view(e){let t=files.get(e.attrs.link);return m("div",{class:e.attrs.class,onclick:()=>navigate(e.attrs.link)},[m(navigationArrow),m("div",[m("span",e.attrs.label+(t.parent?.label&&t.parent.label!==current.parent?.label?` - ${t.parent.label}`:"")),m("label",t.label)])])}},nav={oncreate(){Array.from(document.getElementsByClassName("category")).forEach(e=>e.style.setProperty("--max-height",e.offsetHeight+e.scrollHeight+100+"px"))},view:()=>m("nav",{class:menuOpened?"open":""},m(navFragment,{level:0,children:sitemap,parent:""}))},links={view:()=>m("div",{class:"links"},config?.header?.links?.map(e=>m("a",{href:e.link,target:"_blank"},e.label))??[])},header=()=>({view:()=>m("header",[m("div",{class:"menu"},[m("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",id:"menu-button",onclick:()=>menuOpened=!menuOpened},[m("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25H12"})]),m("img",{src:config?.header?.icon}),m("h1",config?.header?.title)]),m(links)])}),content={onupdate(){for(let e of(contentElement=document.getElementById("content")).querySelectorAll("a[href]"))new URL(document.baseURI).origin!==new URL(e.href,document.baseURI).origin||(e.target=void 0,e.href.startsWith("#")||(e.onclick=t=>{t.preventDefault(),navigate(e.href)}));isFirstPage&&(observer=new IntersectionObserver(observerCallback,{...observerOptions,root:document.querySelector(".body")}),showCurrentHash())},view:()=>m("div",{class:"content",id:"content"},[m("div",{class:"article",id:"article"},exists&&current?0===current.type||current?.content?[m.trust(current?.content),m("div",{class:"bottom-nav"},[null!==current.previous?m(bottomNavLink,{class:"before",label:"Previous",link:current.previous}):void 0,null!==current.next?m(bottomNavLink,{class:"after",label:"Next",link:current.next}):void 0,])]:m("div",{class:"redirects-column"},[m("h1",current.label),...current.children.map(e=>m(redirect,{child:e}))]):m(notFound)),m(links)])},summary={onupdate(e){let t=e.instance.children;for(let n=t.length-1;n>=0;n--)if("active"===t[n].attrs.className){isOutViewport(e.dom,t[n].dom)&&(e.dom.scrollTop=t[n].dom.offsetTop);break}},view:()=>m("aside",headings.map(e=>m("a",{style:`--level:${e.level};`,href:`#${e.hash}`,class:e.reading?"active":""},e.label)))},app={view:()=>m("main",[m(header),m("div",{class:"body"},[m(nav),m(content),m(summary)])])};generateMaps(),update();const favicon=document.createElement("link");favicon.rel="icon",document.head.appendChild(favicon),favicon.href=config.favicon,m.mount(document.body,app),window.onpopstate=()=>{update()},window.onhashchange=()=>{showCurrentHash()};